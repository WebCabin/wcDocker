/*!
 * Web Cabin Docker - Docking Layout Interface.
 *
 * Dependancies:
 *  JQuery 2.1.1
 *
 * Version: git-master
 *
 * Author: Jeff Houde (Lochemage@gmail.com)
 * Web: http://docker.webcabin.org/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *   GPL v3 http://opensource.org/licenses/GPL-3.0
 *
 */
function wcDocker(e){this.$container=$(e).addClass("wcDocker"),this.$transition=$('<div class="wcDockerTransition"></div>'),this.$container.append(this.$transition),this._root=null,this._floatingList=[],this._frameList=[],this._splitterList=[],this._dockPanelTypeList=[],this._draggingSplitter=!1,this._draggingFrame=!1,this._draggingFrameSizer=!1,this._draggingFrameTab=!1,this._ghost=!1,this.__init()}function wcGhost(e,t){this.$ghost=null,this._rect,this._anchorMouse=!1,this._anchor=null,this.__init(e,t)}function wcLayout(e,t){this.$container=$(e),this._parent=t,this._grid=[],this.$elem=null,this.__init()}function wcPanel(e){this.$container=null,this._parent=null,this._panelObject=null,this._type=e,this._title=e,this._layout=null,this._actualPos={x:.5,y:.5},this._actualSize={x:0,y:0},this._pos={x:.5,y:.5},this._size={x:200,y:200},this._minSize={x:100,y:100},this._maxSize={x:Infinity,y:Infinity},this._scrollable={x:!0,y:!0},this._moveable=!0,this._closeable=!0,this._events={},this.__init()}function wcFrame(e,t,n){this.$container=$(e),this._parent=t,this._isFloating=n,this.$frame=null,this.$title=null,this.$center=null,this.$close=null,this.$top=null,this.$bottom=null,this.$left=null,this.$right=null,this.$corner1=null,this.$corner2=null,this.$corner3=null,this.$corner4=null,this.$shadower=null,this._curTab=-1,this._panelList=[],this._pos={x:.5,y:.5},this._size={x:400,y:400},this._anchorMouse={x:0,y:0},this.__init()}function wcSplitter(e,t,n){this.$container=e,this._parent=t,this._horizontal=n,this._pane=[!1,!1],this.$pane=[],this.$bar,this._pos=.4,this._findBestPos=!1,this.__init()}wcDocker.DOCK_FLOAT="float",wcDocker.DOCK_TOP="top",wcDocker.DOCK_LEFT="left",wcDocker.DOCK_RIGHT="right",wcDocker.DOCK_BOTTOM="bottom",wcDocker.EVENT_CLOSED="closed",wcDocker.EVENT_ATTACHED="attached",wcDocker.EVENT_DETACHED="detached",wcDocker.EVENT_MOVED="moved",wcDocker.EVENT_RESIZED="resized",wcDocker.EVENT_SAVE_LAYOUT="save_layout",wcDocker.EVENT_RESTORE_LAYOUT="restore_layout",wcDocker.prototype={registerPanelType:function(e,t,n){for(var r=0;r<this._dockPanelTypeList.length;++r)if(this._dockPanelTypeList[r].name===e)return!1;this._dockPanelTypeList.push({name:e,create:t,isPrivate:n});var i=$("menu").find("menu");return i.append($('<menuitem label="'+e+'">')),!0},addPanel:function(e,t,n,r){for(var i=0;i<this._dockPanelTypeList.length;++i)if(this._dockPanelTypeList[i].name===e){var s=new wcPanel(e);return s.__container(this.$transition),s._panelObject=new this._dockPanelTypeList[i].create(s),n?this.__addPanelGrouped(s,t,r):this.__addPanelAlone(s,t,r),this.__update(),s}return!1},removePanel:function(e){if(!e)return!1;var t=e._parent;if(t instanceof wcFrame){if(!t.removePanel(e)){var n=this._floatingList.indexOf(t);n!==-1&&this._floatingList.splice(n,1),n=this._frameList.indexOf(t),n!==-1&&this._frameList.splice(n,1);var r=t._parent;if(r instanceof wcSplitter){r.__removeChild(t);var i;r.pane(0)?(i=r.pane(0),r._pane[0]=null):(i=r.pane(1),r._pane[1]=null),i.__container(this.$transition),i._parent=null,n=this._splitterList.indexOf(r),n!==-1&&this._splitterList.splice(n,1);var s=r._parent;parentContainer=r.__container(),r.__destroy(),s instanceof wcSplitter?(s.__removeChild(r),s.pane(0)?s.pane(1,i):s.pane(0,i)):s===this&&(this._root=i,i._parent=this,i.__container(parentContainer)),this.__update()}else r===this&&(this._root=null);t.__destroy()}return e.__destroy(),!0}return!1},movePanel:function(e,t,n,r){var i=e.$container;e._parent instanceof wcFrame&&(i=e._parent.$frame);var s=i.offset(),o=i.width(),u=i.height(),a=!1;e._parent instanceof wcFrame&&(a=e._parent._isFloating);var f=e._parent;if(f instanceof wcFrame){for(var l=0;l<f._panelList.length;++l)if(f._panelList[l]===e){f._curTab>=l&&f._curTab--,e.__container(this.$transition),e._parent=null,f._panelList.splice(l,1);break}f._curTab===-1&&f._panelList.length&&(f._curTab=0),f.__updateTabs();if(f._panelList.length===0){var c=this._floatingList.indexOf(f);c!==-1&&this._floatingList.splice(c,1),c=this._frameList.indexOf(f),c!==-1&&this._frameList.splice(c,1);var h=f._parent;if(h instanceof wcSplitter){h.__removeChild(f);var p;h.pane(0)?(p=h.pane(0),h._pane[0]=null):(p=h.pane(1),h._pane[1]=null),p.__container(this.$transition),p._parent=null,c=this._splitterList.indexOf(h),c!==-1&&this._splitterList.splice(c,1);var d=h._parent;parentContainer=h.__container(),h.__destroy(),d instanceof wcSplitter?(d.__removeChild(h),d.pane(0)?d.pane(1,p):d.pane(0,p)):d===this&&(this._root=p,p._parent=this,p.__container(parentContainer)),this.__update()}f.__destroy()}}e.size(o,u),n?this.__addPanelGrouped(e,t,r):this.__addPanelAlone(e,t,r);var v=e._parent;return v instanceof wcFrame&&v.panel()===e&&(v.pos(s.left+o/2+20,s.top+u/2+20,!0),a!==v._isFloating&&(v._isFloating?e.trigger(wcDocker.EVENT_DETACHED):e.trigger(wcDocker.EVENT_ATTACHED))),e.trigger(wcDocker.EVENT_MOVED),this.__update(),e},findPanels:function(e){var t=[];for(var n=0;n<this._frameList.length;++n){var r=this._frameList[n];for(var i=0;i<r._panelList.length;++i){var s=r._panelList[i];s._title===e&&t.push(s)}}return t},trigger:function(e,t){for(var n=0;n<this._frameList.length;++n){var r=this._frameList[n];for(var i=0;i<r._panelList.length;++i){var s=r._panelList[i];s.__trigger(e,t)}}},basicMenu:function(e,t){var n={};for(var r=0;r<t.length;++r)n[t[r].name]=t[r];$.contextMenu({selector:e,animation:{duration:250,show:"fadeIn",hide:"fadeOut"},reposition:!1,autoHide:!0,zIndex:200,items:n})},save:function(){var e={};e.floating=[];for(var t=0;t<this._floatingList.length;++t)e.floating.push(this._floatingList[t].__save());return e.root=this._root.__save(),e},restore:function(e){this.clear(),this._root=this.__create(e.root,this,this.$container),this._root.__restore(e.root,this);for(var t=0;t<e.floating.length;++t){var n=this.__create(e.floating[t],this,this.$container);n.__restore(e.floating[t],this)}this.__update()},clear:function(){this._root=null;for(var e=0;e<this._splitterList.length;++e)this._splitterList[e].__destroy();for(var e=0;e<this._frameList.length;++e)this._frameList[e].__destroy();while(this._frameList.length)this._frameList.pop();while(this._floatingList.length)this._floatingList.pop();while(this._splitterList.length)this._splitterList.pop()},__init:function(){this._root=null;var e=this;$(window).resize(e.__resize.bind(e)),$.contextMenu({selector:".wcFrame",build:function(t,n){var r;for(var i=0;i<e._frameList.length;++i)if(e._frameList[i].$frame[0]===t[0]){r=e._frameList[i];break}var s={x:n.clientX,y:n.clientY},o=!1;s.y-r.$frame.offset().top<=20&&(o=!0);var u={};for(var i=0;i<e._dockPanelTypeList.length;++i){var a=e._dockPanelTypeList[i];a.isPrivate||(u[a.name]={name:a.name,className:"wcMenuCreatePanel"})}var f={};o?(f["Close Panel"]={name:"Close Tab",disabled:!r.panel().closeable()},r._isFloating||(f["Detach Panel"]={name:"Detach Tab",disabled:!r.panel().moveable()}),f.sep1="---------",f.fold1={name:"Add Tab",items:u,disabled:!!r._isFloating||!r.panel().moveable(),className:"wcMenuCreatePanel"},f.sep2="---------",f["Flash Panel"]={name:"Flash Tab"}):(f["Close Panel"]={name:"Close Panel",disabled:!r.panel().closeable()},r._isFloating||(f["Detach Panel"]={name:"Detach Panel",disabled:!r.panel().moveable()}),f.sep1="---------",f.fold1={name:"Insert Panel",items:u,disabled:!!r._isFloating||!r.panel().moveable(),className:"wcMenuCreatePanel"},f.sep2="---------",f["Flash Panel"]={name:"Flash Panel"});if(!r._isFloating&&r.panel().moveable()){var l=r.__rect();e._ghost=new wcGhost(l,s),r.__checkAnchorDrop(s,!1,e._ghost,!0),e._ghost.$ghost.hide()}return{callback:function(t,n){if(t==="Close Panel")setTimeout(function(){r.panel().close()},10);else if(t==="Detach Panel")e.movePanel(r.panel(),wcDocker.DOCK_FLOAT,!1);else if(t==="Flash Panel")e.__focus(r,!0);else if(r&&e._ghost){var i=e._ghost.anchor();e.addPanel(t,i.loc,i.merge,r.panel())}},events:{show:function(e){},hide:function(t){e._ghost&&(e._ghost.__destroy(),e._ghost=!1)}},animation:{duration:250,show:"fadeIn",hide:"fadeOut"},reposition:!1,autoHide:!0,zIndex:200,items:f}}});var t;$("body").on("contextmenu","a, img",function(){return t&&clearTimeout(t),$(".wcFrame").contextMenu(!1),t=setTimeout(function(){$(".wcFrame").contextMenu(!0),t=null},100),!0}),$("body").on("contextmenu",".wcSplitterBar",function(){return!1}),$("body").on("mouseenter",".wcMenuCreatePanel",function(){e._ghost&&e._ghost.$ghost.stop().fadeIn(200)}),$("body").on("mouseleave",".wcMenuCreatePanel",function(){e._ghost&&e._ghost.$ghost.stop().fadeOut(200)}),$("body").on("mousedown",".wcPanelTab",function(e){e.preventDefault(),e.returnValue=!1}),$("body").on("click",".wcFrameCloseButton",function(){var t;for(var n=0;n<e._frameList.length;++n)if(e._frameList[n].$close[0]==this){t=e._frameList[n];break}if(t){var r=t.panel();e.removePanel(r),e.__update()}}),$("body").on("mousedown",".wcSplitterBar",function(t){if(t.which===3)return!0;e.$container.addClass("wcDisableSelection");for(var n=0;n<e._splitterList.length;++n)if(e._splitterList[n].$bar[0]===this){e._draggingSplitter=e._splitterList[n];break}return!0}),$("body").on("mousedown",".wcFrameTitle",function(t){if(t.which===3)return!0;e.$container.addClass("wcDisableSelection");for(var n=0;n<e._frameList.length;++n)if(e._frameList[n].$title[0]==this){e._draggingFrame=e._frameList[n];var r={x:t.clientX,y:t.clientY};e._draggingFrame.__anchorMove(r),$(t.target).hasClass("wcPanelTab")&&(e._draggingFrameTab=t.target);if(!e._draggingFrame._isFloating||t.which!==1||e._draggingFrameTab){var i=e._draggingFrame.__rect();e._ghost=new wcGhost(i,r),e._draggingFrame.__checkAnchorDrop(r,!0,e._ghost,!0)}break}return e._draggingFrame&&e.__focus(e._draggingFrame),!0}),$("body").on("mousedown",".wcLayout",function(t){if(t.which===3)return!0;for(var n=0;n<e._frameList.length;++n)if(e._frameList[n].$center[0]==this){e.__focus(e._frameList[n]);break}return!0}),$("body").on("mousedown",".wcFrameEdge",function(t){if(t.which===3)return!0;e.$container.addClass("wcDisableSelection");for(var n=0;n<e._frameList.length;++n)if(e._frameList[n]._isFloating){if(e._frameList[n].$top[0]==this){e._draggingFrame=e._frameList[n],e._draggingFrameSizer=["top"];break}if(e._frameList[n].$bottom[0]==this){e._draggingFrame=e._frameList[n],e._draggingFrameSizer=["bottom"];break}if(e._frameList[n].$left[0]==this){e._draggingFrame=e._frameList[n],e._draggingFrameSizer=["left"];break}if(e._frameList[n].$right[0]==this){e._draggingFrame=e._frameList[n],e._draggingFrameSizer=["right"];break}if(e._frameList[n].$corner1[0]==this){e._draggingFrame=e._frameList[n],e._draggingFrameSizer=["top","left"];break}if(e._frameList[n].$corner2[0]==this){e._draggingFrame=e._frameList[n],e._draggingFrameSizer=["top","right"];break}if(e._frameList[n].$corner3[0]==this){e._draggingFrame=e._frameList[n],e._draggingFrameSizer=["bottom","right"];break}if(e._frameList[n].$corner4[0]==this){e._draggingFrame=e._frameList[n],e._draggingFrameSizer=["bottom","left"];break}}return e._draggingFrame&&e.__focus(e._draggingFrame),!0}),$("body").on("mousemove",function(t){if(t.which===3)return!0;if(e._draggingSplitter){var n={x:t.clientX,y:t.clientY};e._draggingSplitter.__moveBar(n),e._draggingSplitter.__update()}else if(e._draggingFrameSizer){var n={x:t.clientX,y:t.clientY},r=e.$container.offset();n.x+=r.left,n.y+=r.top,e._draggingFrame.__resize(e._draggingFrameSizer,n),e._draggingFrame.__update()}else if(e._draggingFrame){var n={x:t.clientX,y:t.clientY};if(e._ghost){e._ghost.__move(n);var i=!e._draggingFrame._isFloating&&t.which!==1,s=!1;if(!e._draggingFrame.__checkAnchorDrop(n,!0,e._ghost,e._draggingFrame._panelList.length>1&&e._draggingFrameTab)){e._draggingFrame.__shadow(!0);if(!i)for(var o=0;o<e._frameList.length;++o)if(e._frameList[o]!==e._draggingFrame&&e._frameList[o].__checkAnchorDrop(n,!1,e._ghost,!0))return;e._ghost.anchor(n,null)}else e._draggingFrame.__shadow(!1),e._draggingFrameTab&&$(t.target).hasClass("wcPanelTab")&&e._draggingFrameTab!==t.target&&(e._draggingFrameTab=e._draggingFrame.__tabMove(parseInt($(e._draggingFrameTab).attr("id")),parseInt($(t.target).attr("id"))))}else e._draggingFrameTab||(e._draggingFrame.__move(n),e._draggingFrame.__update())}return!0}),$("body").on("mouseup",function(t){if(t.which===3)return!0;e.$container.removeClass("wcDisableSelection");if(e._draggingFrame)for(var n=0;n<e._frameList.length;++n)e._frameList[n].__shadow(!1);if(e._ghost&&e._draggingFrame){var r=e._ghost.anchor();if(!r){var i=e._draggingFrame._curTab;e._draggingFrameTab||e._draggingFrame.panel(0);var s=e.movePanel(e._draggingFrame.panel(),wcDocker.DOCK_FLOAT,!1),o={x:t.clientX,y:t.clientY};if(!e._draggingFrameTab)while(e._draggingFrame.panel())e.movePanel(e._draggingFrame.panel(),wcDocker.DOCK_BOTTOM,!0,s);var u=s._parent;u instanceof wcFrame&&(u.pos(o.x,o.y+e._ghost.__rect().h/2-10,!0),u.panel(i)),u._size.x=e._ghost.__rect().w,u._size.y=e._ghost.__rect().h,u.__update()}else if(!r.self){var i=e._draggingFrame._curTab;e._draggingFrameTab||e._draggingFrame.panel(0);var s;r.item&&(s=r.item._parent);if(s===e._draggingFrame.panel())for(var n=0;n<e._draggingFrame._panelList.length;++n)if(s!==e._draggingFrame._panelList[n]){s=e._draggingFrame._panelList[n],i--;break}var u=s._parent;u instanceof wcFrame&&(i+=u._panelList.length),s=e.movePanel(e._draggingFrame.panel(),r.loc,r.merge,s),s._parent.panel(s._parent._panelList.length-1);if(!e._draggingFrameTab)while(e._draggingFrame.panel())e.movePanel(e._draggingFrame.panel(),wcDocker.DOCK_BOTTOM,!0,s);var u=s._parent;u instanceof wcFrame&&u.panel(i)}e._ghost.__destroy(),e._ghost=!1}return e._draggingSplitter=!1,e._draggingFrame=!1,e._draggingFrameSizer=!1,e._draggingFrameTab=!1,!0})},__update:function(){this._root&&this._root.__update();for(var e=0;e<this._floatingList.length;++e)this._floatingList[e].__update()},__resize:function(e){this.__update()},__focus:function(e,t){if(e._isFloating){var n=[];for(var r=0;r<e._panelList.length;++r)n.push(e._panelList[r].scroll());$("body").append(e.$frame);for(var r=0;r<n.length;++r)e._panelList[r].scroll(n[r].x,n[r].y)}e.__focus(t)},__create:function(e,t,n){switch(e.type){case"wcSplitter":var r=new wcSplitter(n,t,e.horizontal);return this._splitterList.push(r),r;case"wcFrame":var i=new wcFrame(n,t,e.floating);return this._frameList.push(i),e.floating&&this._floatingList.push(i),i;case"wcPanel":var s=new wcPanel(e.panelType);s.__container(n),s._parent=t;for(var o=0;o<this._dockPanelTypeList.length;++o)if(this._dockPanelTypeList[o].name===e.panelType){this._dockPanelTypeList[o].create(s);break}return s}return null},__addPanelAlone:function(e,t,n){if(t===wcDocker.DOCK_FLOAT){var r=new wcFrame(this.$container,this,!0);this._frameList.push(r),this._floatingList.push(r),r.addPanel(e),r.pos(e._pos.x,e._pos.y,!1);return}if(n){var i=n._parent;if(i instanceof wcFrame){var s=i._parent;if(s instanceof wcSplitter){var o,u=s.pane(0),a=s.pane(1);u===i?(o=new wcSplitter(this.$transition,s,t!==wcDocker.DOCK_BOTTOM&&t!==wcDocker.DOCK_TOP),s.pane(0,o)):(o=new wcSplitter(this.$transition,s,t!==wcDocker.DOCK_BOTTOM&&t!==wcDocker.DOCK_TOP),s.pane(1,o)),o&&(this._splitterList.push(o),r=new wcFrame(this.$transition,o,!1),this._frameList.push(r),t===wcDocker.DOCK_LEFT||t===wcDocker.DOCK_TOP?(o.pane(0,r),o.pane(1,i),o.pos(.4)):(o.pane(0,i),o.pane(1,r),o.pos(.6)),r.addPanel(e));return}}}var r=new wcFrame(this.$transition,this,!1);this._frameList.push(r);if(!this._root)this._root=r,r.__container(this.$container);else{var o=new wcSplitter(this.$container,this,t!==wcDocker.DOCK_BOTTOM&&t!==wcDocker.DOCK_TOP);o&&(this._splitterList.push(o),r._parent=o,t===wcDocker.DOCK_LEFT||t===wcDocker.DOCK_TOP?(o.pane(0,r),o.pane(1,this._root),o.__findBestPos()):(o.pane(0,this._root),o.pane(1,r),o.__findBestPos()),this._root=o)}r.addPanel(e)},__addPanelGrouped:function(e,t,n){function s(n){if(n instanceof wcSplitter){var r=n.pane(0),o=n.pane(1);if(n.isHorizontal()===i){if(r instanceof wcFrame&&(t===wcDocker.DOCK_LEFT||t===wcDocker.DOCK_TOP))return r.addPanel(e),!0;if(o instanceof wcFrame&&(t===wcDocker.DOCK_RIGHT||t===wcDocker.DOCK_BOTTOM))return o.addPanel(e),!0}return r instanceof wcFrame?s.call(this,o):s.call(this,r)}return!1}if(n){var r=n._parent;if(r instanceof wcFrame){r.addPanel(e);return}}if(t===wcDocker.DOCK_FLOAT){var r;this._floatingList.length&&(r=this._floatingList[this._floatingList.length-1]);if(!r){this.__addPanelAlone(e,t);return}r.addPanel(e);return}var i=t!==wcDocker.DOCK_BOTTOM;s.call(this,this._root)||this.__addPanelAlone(e,t)}},wcGhost.prototype={anchor:function(e,t){if(typeof e=="undefined")return this._anchor;if(t&&this._anchor&&t.loc===this._anchor.loc&&t.item===this._anchor.item)return;var n={x:parseInt(this.$ghost.css("left")),y:parseInt(this.$ghost.css("top")),w:parseInt(this.$ghost.css("width")),h:parseInt(this.$ghost.css("height"))};this._anchorMouse={x:n.x-e.x,y:n.y-e.y},this._rect.x=-this._anchorMouse.x,this._rect.y=-this._anchorMouse.y;if(!t){if(!this._anchor)return;this._anchor=null,this.$ghost.show(),this.$ghost.stop().animate({opacity:.3,"margin-left":this._rect.x-this._rect.w/2+"px","margin-top":this._rect.y-10+"px",width:this._rect.w+"px",height:this._rect.h+"px"},200);return}this._anchor=t;var r=.8;t.self&&t.merge?(r=0,this.$ghost.hide()):this.$ghost.show(),this.$ghost.stop().animate({opacity:r,"margin-left":"2px","margin-top":"2px",border:"0px",left:t.x+"px",top:t.y+"px",width:t.w+"px",height:t.h+"px"},200)},__init:function(e,t){this.$ghost=$('<div class="wcGhost">').css("opacity",0).css("top",e.y+"px").css("left",e.x+"px").css("width",e.w+"px").css("height",e.h+"px"),this._anchorMouse={x:e.x-t.x,y:e.y-t.y},this._rect={x:-this._anchorMouse.x,y:-this._anchorMouse.y,w:e.w,h:e.h},$("body").append(this.$ghost),this.anchor(t,e)},__rect:function(){return this._rect},__move:function(e){if(this._anchor)return;var t=parseInt(this.$ghost.css("left")),n=parseInt(this.$ghost.css("top"));t=e.x+this._anchorMouse.x,n=e.y+this._anchorMouse.y,this.$ghost.css("left",t+"px"),this.$ghost.css("top",n+"px")},__destroy:function(){this.$ghost.stop().animate({opacity:0},{duration:250,complete:function(){$(this).remove()}})}},wcLayout.prototype={addItem:function(e,t,n,r,i){if(typeof t=="undefined"||t<0)t=0;if(typeof n=="undefined"||n<0)n=0;if(typeof r=="undefined"||r<=0)r=1;if(typeof i=="undefined"||i<=0)i=1;return this.__resizeGrid(t+r-1,n+i-1),this.__mergeGrid(t,n,r,i)?(this._grid[n][t].$el.append($(e)),this._grid[n][t].$el):!1},clear:function(){var e=this.showGrid();this.__init(),this.showGrid(e),this._grid=[]},showGrid:function(e){return typeof e=="undefined"?this.$elem.hasClass("wcLayoutGrid"):(this.$elem.toggleClass("wcLayoutGrid",e),this.$elem.hasClass("wcLayoutGrid"))},__init:function(){this.$elem=$('<table class="wcLayout wcWide wcTall wcPanelBackground"></table>'),this.$elem.append($("<tbody></tbody>")),this.__container(this.$container)},__update:function(){},__resizeGrid:function(e,t){this.$elem.find("tbody").children().remove();for(var n=0;n<=t;++n){this._grid.length<=n&&this._grid.push([]);for(var r=0;r<=e;++r)this._grid[n].length<=r&&this._grid[n].push({$el:$("<td>"),x:0,y:0})}var i=this.$elem.find("tbody");for(var n=0;n<this._grid.length;++n){var s=null;for(var r=0;r<this._grid[n].length;++r){var o=this._grid[n][r];o.$el&&(s||(s=$("<tr>"),this.$elem.append(s)),s.append(o.$el))}}},__mergeGrid:function(e,t,n,r){if(this._grid.length<=t||this._grid[t].length<=e)return!1;for(var i=0;i<r;++i)for(var s=0;s<n;++s){var o=this._grid[t+i][e+s];if(!o.$el||o.x!==0||o.y!==0)return!1}var o=this._grid[t][e];n>1&&(o.$el.attr("colspan",""+n),o.x=n-1),r>1&&(o.$el.attr("rowspan",""+r),o.y=r-1);for(var i=0;i<r;++i)for(var s=0;s<n;++s)if(i!==0||s!==0){var o=this._grid[t+i][e+s];o.$el.remove(),o.$el=null,o.x=-s,o.y=-i}return!0},__checkAnchorDrop:function(e,t,n,r,i,s){var o=i.width(),u=i.height(),a=i.offset(),f=this.$elem.offset().top-a.top;s||(f=0);if(t&&e.y>=a.top&&e.y<=a.top+f&&e.x>=a.left&&e.x<=a.left+o)return n.anchor(e,{x:a.left,y:a.top,w:o,h:f-2,merge:!0,loc:wcDocker.DOCK_FLOAT,item:this,self:!0}),!0;if(s&&e.y>=a.top&&e.y<=a.top+f&&e.x>=a.left&&e.x<=a.left+o)return n.anchor(e,{x:a.left,y:a.top,w:o,h:f-2,merge:!0,loc:wcDocker.DOCK_BOTTOM,item:this,self:!1}),!0;if(!r)return!1;if(o<u){if(e.y>=a.top&&e.y<=a.top+u*.25&&e.x>=a.left&&e.x<=a.left+o)return n.anchor(e,{x:a.left,y:a.top,w:o,h:u*.4,loc:wcDocker.DOCK_TOP,item:this,self:!1}),!0;if(e.y>=a.top+u*.75&&e.y<=a.top+u&&e.x>=a.left&&e.x<=a.left+o)return n.anchor(e,{x:a.left,y:a.top+(u-u*.4),w:o,h:u*.4,loc:wcDocker.DOCK_BOTTOM,item:this,self:!1}),!0}if(e.y>=a.top&&e.y<=a.top+u){if(e.x>=a.left&&e.x<=a.left+o*.25)return n.anchor(e,{x:a.left,y:a.top,w:o*.4,h:u,loc:wcDocker.DOCK_LEFT,item:this,self:!1}),!0;if(e.x>=a.left+o*.75&&e.x<=a.left+o)return n.anchor(e,{x:a.left+o*.6,y:a.top,w:o*.4,h:u,loc:wcDocker.DOCK_RIGHT,item:this,self:!1}),!0}if(o>=u){if(e.y>=a.top&&e.y<=a.top+u*.25&&e.x>=a.left&&e.x<=a.left+o)return n.anchor(e,{x:a.left,y:a.top,w:o,h:u*.4,loc:wcDocker.DOCK_TOP,item:this,self:!1}),!0;if(e.y>=a.top+u*.75&&e.y<=a.top+u&&e.x>=a.left&&e.x<=a.left+o)return n.anchor(e,{x:a.left,y:a.top+(u-u*.4),w:o,h:u*.4,loc:wcDocker.DOCK_BOTTOM,item:this,self:!1}),!0}return!1},__container:function(e){return typeof e=="undefined"?this.$container:(this.$container=e,this.$container?this.$container.append(this.$elem):this.$elem.remove(),this.$container)},__destroy:function(){this.__container(null),this._parent=null,this.clear(),this.$elem.remove(),this.$elem=null}},wcPanel.prototype={docker:function(){var e=this._parent;while(e&&!(e instanceof wcDocker))e=e._parent;return e},title:function(e){return typeof e!="undefined"&&(this._title=e),this._title},layout:function(){return this._layout},focus:function(e){var t=this.docker();t&&t.__focus(this._parent,e)},pos:function(e,t){if(typeof e=="undefined")return{x:this._pos.x,y:this._pos.y};this._pos.x=e,this._pos.y=t},size:function(e,t){if(typeof e=="undefined")return{x:this._size.x,y:this._size.y};this._size.x=e,this._size.y=t},minSize:function(e,t){if(typeof e=="undefined")return this._minSize;this._minSize.x=e,this._minSize.y=t},maxSize:function(e,t){if(typeof e=="undefined")return this._maxSize;this._maxSize.x=e,this._maxSize.y=t},scroll:function(e,t){return this.$container?(typeof e!="undefined"&&(this.$container.parent().scrollLeft(e),this.$container.parent().scrollTop(t)),{x:this.$container.parent().scrollLeft(),y:this.$container.parent().scrollTop()}):{x:0,y:0}},scrollable:function(e,t){return typeof e!="undefined"&&(this._scrollable.x=e?!0:!1,this._scrollable.y=t?!0:!1),{x:this._scrollable.x,y:this._scrollable.y}},moveable:function(e){return typeof e!="undefined"&&(this._moveable=e?!0:!1),this._moveable},closeable:function(e){return typeof e!="undefined"&&(this._closeable=e?!0:!1,this._parent&&this._parent.__update()),this._closeable},close:function(){this._parent&&this._parent.$close.click()},on:function(e,t){return e?(this._events[e]||(this._events[e]=[]),this._events[e].indexOf(t)!==-1?!1:(this._events[e].push(t),!0)):!1},off:function(e,t){if(typeof e=="undefined"){this._events={};return}if(this._events[e])if(typeof t=="undefined")this._events[e]=[];else for(var n=0;n<this._events[e].length;++n)if(this._events[e][n]===t){this._events[e].splice(n,1);break}},trigger:function(e,t){var n=this.docker();n&&n.trigger(e,t)},__init:function(){this._layout=new wcLayout(this.$container,this)},__update:function(){this._layout.__update();if(!this.$container)return;var e=this.$container.width(),t=this.$container.height();if(this._actualSize.x!==e||this._actualSize.y!==t)this._actualSize.x=e,this._actualSize.y=t,this.__trigger(wcDocker.EVENT_RESIZED);var n=this.$container.offset();if(this._actualPos.x!==n.left||this._actualPos.y!==n.top)this._actualPos.x=n.left,this._actualPos.y=n.top,this.__trigger(wcDocker.EVENT_MOVED)},__save:function(){var e={};return e.type="wcPanel",e.panelType=this._type,e.title=this._title,e.minSize={x:this._minSize.x,y:this._minSize.y},e.maxSize={x:this._maxSize.x,y:this._maxSize.y},e.scrollable={x:this._scrollable.x,y:this._scrollable.y},e.moveable=this._moveable,e.closeable=this._closeable,e.customData={},this.__trigger(wcDocker.EVENT_SAVE_LAYOUT,e.customData),e},__restore:function(e,t){this._title=e.title,this._minSize.x=e.minSize.x,this._minSize.y=e.minSize.y,this._maxSize.x=e.maxSize.x,this._maxSize.y=e.maxSize.y,this._scrollable.x=e.scrollable.x,this._scrollable.y=e.scrollable.y,this._moveable=e.moveable,this._closeable=e.closeable,this.__trigger(wcDocker.EVENT_RESTORE_LAYOUT,e.customData)},__trigger:function(e,t){if(!e)return!1;if(this._events[e])for(var n=0;n<this._events[e].length;++n)this._events[e][n](this,t)},__rect:function(){var e=this.$container.offset(),t=this.$container.width(),n=this.$container.height();return{x:e.left,y:e.top,w:t,h:n}},__container:function(e){return typeof e=="undefined"?this.$container:(this.$container=e,this.$container?this._layout.__container(this.$container):this._layout.__container(null),this.$container)},__destroy:function(){this._panelObject=null,this.__trigger(wcDocker.EVENT_CLOSED),this.off(),this.__container(null),this._parent=null}},wcFrame.prototype={pos:function(e,t,n){var r=this.$container.width(),i=this.$container.height();if(typeof e=="undefined")return n?{x:this._pos.x*r,y:this._pos.y*i}:{x:this._pos.x,y:this._pos.y};n?(this._pos.x=e/r,this._pos.y=t/i):(this._pos.x=e,this._pos.y=t)},size:function(){var e={x:-1,y:-1};for(var t=0;t<this._panelList.length;++t)e.x<this._panelList[t].size().x&&(e.x=this._panelList[t].size().x),e.y<this._panelList[t].size().y&&(e.y=this._panelList[t].size().y);return e.x<0||e.y<0?!1:e},minSize:function(){var e={x:0,y:0};for(var t=0;t<this._panelList.length;++t)e.x=Math.max(e.x,this._panelList[t].minSize().x),e.y=Math.max(e.y,this._panelList[t].minSize().y);return e},maxSize:function(){var e={x:Infinity,y:Infinity};for(var t=0;t<this._panelList.length;++t)e.x=Math.min(e.x,this._panelList[t].maxSize().x),e.y=Math.min(e.y,this._panelList[t].maxSize().y);return e},addPanel:function(e,t){var n=this._panelList.indexOf(e);n!==-1&&this._panelList.splice(n,1),typeof t=="undefined"?this._panelList.push(e):this._panelList.splice(t,0,e),this._curTab===-1&&this._panelList.length&&(this._curTab=0),this._size=this.size(),this.__updateTabs()},removePanel:function(e){for(var t=0;t<this._panelList.length;++t)if(this._panelList[t]===e){this._curTab>=t&&this._curTab--,this._panelList[t].__container(null),this._panelList[t]._parent=null,this._panelList.splice(t,1);break}return this._curTab===-1&&this._panelList.length&&(this._curTab=0),this.__updateTabs(),this._panelList.length>0},panel:function(e){return e!=="undefined"&&e>-1&&e<this._panelList.length&&(this.$title.find('div[id="'+this._curTab+'"]').removeClass("wcPanelTabActive"),this.$center.find('.wcPanelTabContent[id="'+this._curTab+'"]').addClass("wcPanelTabContentHidden"),this._curTab=e,this.$title.find('div[id="'+e+'"]').addClass("wcPanelTabActive"),this.$center.find('.wcPanelTabContent[id="'+e+'"]').removeClass("wcPanelTabContentHidden"),this.__onTabChange()),this._curTab>-1&&this._curTab<this._panelList.length?this._panelList[this._curTab]:!1},__init:function(){this.$frame=$('<div class="wcFrame wcWide wcTall wcPanelBackground">'),this.$title=$('<div class="wcFrameTitle">'),this.$center=$('<div class="wcFrameCenter wcWide">'),this.$close=$('<div class="wcFrameCloseButton">X</div>'),this.$frame.append(this.$title),this.$frame.append(this.$close),this._isFloating&&(this.$top=$('<div class="wcFrameEdgeH wcFrameEdge"></div>').css("top","-6px").css("left","0px").css("right","0px"),this.$bottom=$('<div class="wcFrameEdgeH wcFrameEdge"></div>').css("bottom","-6px").css("left","0px").css("right","0px"),this.$left=$('<div class="wcFrameEdgeV wcFrameEdge"></div>').css("left","-6px").css("top","0px").css("bottom","0px"),this.$right=$('<div class="wcFrameEdgeV wcFrameEdge"></div>').css("right","-6px").css("top","0px").css("bottom","0px"),this.$corner1=$('<div class="wcFrameCornerNW wcFrameEdge"></div>').css("top","-6px").css("left","-6px"),this.$corner2=$('<div class="wcFrameCornerNE wcFrameEdge"></div>').css("top","-6px").css("right","-6px"),this.$corner3=$('<div class="wcFrameCornerNW wcFrameEdge"></div>').css("bottom","-6px").css("right","-6px"),this.$corner4=$('<div class="wcFrameCornerNE wcFrameEdge"></div>').css("bottom","-6px").css("left","-6px"),this.$frame.append(this.$top),this.$frame.append(this.$bottom),this.$frame.append(this.$left),this.$frame.append(this.$right),this.$frame.append(this.$corner1),this.$frame.append(this.$corner2),this.$frame.append(this.$corner3),this.$frame.append(this.$corner4)),this.$frame.append(this.$center),this.__container(this.$container),this._isFloating&&this.$frame.addClass("wcFloating")},__update:function(){var e=this.$container.width(),t=this.$container.height();if(this._isFloating){var n=this._pos.x*e-this._size.x/2,r=this._pos.y*t-this._size.y/2;r<0&&(r=0),n+this._size.x/2<0&&(n=-this._size.x/2),n+this._size.x/2>e&&(n=e-this._size.x/2),r+parseInt(this.$center.css("top"))>t&&(r=t-parseInt(this.$center.css("top"))),this.$frame.css("left",n+"px"),this.$frame.css("top",r+"px"),this.$frame.css("width",this._size.x+"px"),this.$frame.css("height",this._size.y+"px")}this.__updateTabs()},__save:function(){var e={};e.type="wcFrame",e.floating=this._isFloating,e.pos={x:this._pos.x,y:this._pos.y},e.size={x:this._size.x,y:this._size.y},e.tab=this._curTab,e.panels=[];if(!e.center)for(var t=0;t<this._panelList.length;++t)e.panels.push(this._panelList[t].__save());return e},__restore:function(e,t){this._isFloating=e.floating,this._pos.x=e.pos.x,this._pos.y=e.pos.y,this._size.x=e.size.x,this._size.y=e.size.y,this._curTab=e.tab;for(var n=0;n<e.panels.length;++n){var r=t.__create(e.panels[n],this,this.$center);r.__restore(e.panels[n],t),this._panelList.push(r)}this.__update()},__updateTabs:function(){this.$title.empty();var e=$("<div>");this.$frame.append(e),this.$center.children().appendTo(e);var t=this;for(var n=0;n<this._panelList.length;++n){var r=$('<div id="'+n+'" class="wcPanelTab">'+this._panelList[n].title()+"</div>");this.$title.append(r);var i=$('<div class="wcPanelTabContent wcPanelBackground" id="'+n+'">');this.$center.append(i),this._panelList[n].__container(i),this._panelList[n]._parent=this,this._curTab!==n?i.addClass("wcPanelTabContentHidden"):r.addClass("wcPanelTabActive"),r.on("mousedown",function(e){var n=parseInt($(this).attr("id"));t.panel(n)})}e.remove(),this.__onTabChange()},__onTabChange:function(){var e=this.panel();if(e){var t=e.scrollable();this.$center.toggleClass("wcScrollableX",t.x),this.$center.toggleClass("wcScrollableY",t.y),e.moveable()&&e.title()?(this.$frame.prepend(this.$title),this.$center.css("top","")):(this.$title.remove(),this.$center.css("top","0px")),e.closeable()?this.$frame.append(this.$close):this.$close.remove(),e.__update()}},__focus:function(e){if(e){var t=$('<div class="wcFrameFlasher">');this.$frame.append(t),t.animate({opacity:.25},100).animate({opacity:0},100).animate({opacity:.1},50).animate({opacity:0},50).queue(function(e){t.remove(),e()})}},__move:function(e){var t=this.$container.width(),n=this.$container.height();this._pos.x=(e.x+this._anchorMouse.x)/t,this._pos.y=(e.y+this._anchorMouse.y)/n},__anchorMove:function(e){var t=this.$container.width(),n=this.$container.height();this._anchorMouse.x=this._pos.x*t-e.x,this._anchorMouse.y=this._pos.y*n-e.y},__tabMove:function(e,t){if(e>=0&&e<this._panelList.length&&t>=0&&t<this._panelList.length){var n=this._panelList.splice(e,1);return this._panelList.splice(t,0,n[0]),this._curTab===e&&(this._curTab=t),this.__updateTabs(),this.$title.find('.wcPanelTab[id="'+t+'"]')[0]}return!1},__checkAnchorDrop:function(e,t,n,r){var i=this.panel();return i&&i.moveable()?i.layout().__checkAnchorDrop(e,t,n,!this._isFloating&&r,this.$frame,i.moveable()&&i.title()):!1},__resize:function(e,t){var n=this.$container.width(),r=this.$container.height(),i=this.$container.offset();t.x-=i.left,t.y-=i.top;var s=this.minSize(),o=this.maxSize(),u={x:this._pos.x*n-this._size.x/2,y:this._pos.y*r-this._size.y/2};for(var a=0;a<e.length;++a){switch(e[a]){case"top":this._size.y+=u.y-t.y-2,u.y=t.y+2,this._size.y<s.y&&(u.y+=this._size.y-s.y,this._size.y=s.y),this._size.y>o.y&&(u.y+=this._size.y-o.y,this._size.y=o.y);break;case"bottom":this._size.y=t.y-4-u.y,this._size.y<s.y&&(this._size.y=s.y),this._size.y>o.y&&(this._size.y=o.y);break;case"left":this._size.x+=u.x-t.x-2,u.x=t.x+2,this._size.x<s.x&&(u.x+=this._size.x-s.x,this._size.x=s.x),this._size.x>o.x&&(u.x+=this._size.x-o.x,this._size.x=o.x);break;case"right":this._size.x=t.x-4-u.x,this._size.x<s.x&&(this._size.x=s.x),this._size.x>o.x&&(this._size.x=o.x)}this._pos.x=(u.x+this._size.x/2)/n,this._pos.y=(u.y+this._size.y/2)/r}},__shadow:function(e){if(e)this.$shadower||(this.$shadower=$('<div class="wcFrameShadower">'),this.$frame.append(this.$shadower),this.$shadower.animate({opacity:.5},300));else if(this.$shadower){var t=this;this.$shadower.animate({opacity:0},300).queue(function(e){t.$shadower.remove(),t.$shadower=null,e()})}},__rect:function(){var e=this.$frame.offset(),t=this.$frame.width(),n=this.$frame.height();return{x:e.left,y:e.top,w:t,h:n}},__container:function(e){return typeof e=="undefined"?this.$container:(this.$container=e,this.$container?this.$container.append(this.$frame):this.$frame.remove(),this.$container)},__destroy:function(){this._curTab=-1;for(var e=0;e<this._panelList.length;++e)this._panelList[e].__destroy();while(this._panelList.length)this._panelList.pop();this.__container(null),this._parent=null}},wcSplitter.prototype={isHorizontal:function(){return this._horizontal},minSize:function(){var e,t;return this._pane[0]&&typeof this._pane[0].minSize=="function"&&(e=this._pane[0].minSize()),this._pane[1]&&typeof this._pane[1].minSize=="function"&&(t=this._pane[1].minSize()),e&&t?(this._horizontal?(e.x+=t.x,e.y=Math.max(e.y,t.y)):(e.y+=t.y,e.x=Math.max(e.x,t.x)),e):e?e:t?t:!1},maxSize:function(){var e,t;return this._pane[0]&&typeof this._pane[0].maxSize=="function"&&(e=this._pane[0].maxSize()),this._pane[1]&&typeof this._pane[1].maxSize=="function"&&(t=this._pane[1].maxSize()),e&&t?(this._horizontal?(e.x+=t.x,e.y=Math.min(e.y,t.y)):(e.y+=t.y,e.x=Math.min(e.x,t.x)),e):e?e:t?t:!1},pos:function(e){return typeof e=="undefined"?this._pos:(this._pos=e,this._pos)},pane:function(e,t){if(e>=0&&e<2){if(typeof t=="undefined")return this._pane[e];if(t)return this._pane[e]=t,t._parent=this,t.__container(this.$pane[e]),t;this._pane[e]&&(this._pane[e].__container(null),this._pane[e]=!1)}return!1},__init:function(){this.$pane.push($('<div class="wcLayoutPane">')),this.$pane.push($('<div class="wcLayoutPane">')),this.$bar=$('<div class="wcSplitterBar">'),this._horizontal?(this.$pane[0].addClass("wcTall"),this.$pane[1].addClass("wcTall"),this.$bar.addClass("wcTall").addClass("wcSplitterBarV")):(this.$pane[0].addClass("wcWide"),this.$pane[1].addClass("wcWide"),this.$bar.addClass("wcWide").addClass("wcSplitterBarH")),this.__container(this.$container)},__update:function(){var e=this.$container.width(),t=this.$container.height(),n=this.__minPos(),r=this.__maxPos();if(this._findBestPos){this._findBestPos=!1;var i,s;this._pane[0]&&typeof this._pane[0].size=="function"&&(i=this._pane[0].size()),this._pane[1]&&typeof this._pane[1].size=="function"&&(s=this._pane[1].size(),s&&(s.x=e-s.x,s.y=t-s.y));var o;i&&s?o={x:Math.min(i.x,s.x),y:Math.min(i.y,s.y)}:i?o=i:s&&(o=s),o&&(this._horizontal?this._pos=o.x/e:this._pos=o.y/t)}if(this._horizontal){var o=e*this._pos;n&&(o=Math.max(n.x,o)),r&&(o=Math.min(r.x,o)),this.$bar.css("left",o+1),this.$pane[0].css("width",o-1+"px"),this.$pane[0].css("left","0px"),this.$pane[0].css("right",""),this.$pane[1].css("left",""),this.$pane[1].css("right","0px"),this.$pane[1].css("width",e-o-5+"px")}else{var o=t*this._pos;n&&(o=Math.max(n.y,o)),r&&(o=Math.min(r.y,o)),this.$bar.css("top",o+1),this.$pane[0].css("height",o-1+"px"),this.$pane[0].css("top","0px"),this.$pane[0].css("bottom",""),this.$pane[1].css("top",""),this.$pane[1].css("bottom","0px"),this.$pane[1].css("height",t-o-5+"px")}this._pane[0].__update(),this._pane[1].__update()},__save:function(){var e={};return e.type="wcSplitter",e.horizontal=this._horizontal,e.pane0=this._pane[0]?this._pane[0].__save():null,e.pane1=this._pane[1]?this._pane[1].__save():null,e.pos=this._pos,e},__restore:function(e,t){this._pos=e.pos,e.pane0&&(this._pane[0]=t.__create(e.pane0,this,this.$pane[0]),this._pane[0].__restore(e.pane0,t)),e.pane1&&(this._pane[1]=t.__create(e.pane1,this,this.$pane[1]),this._pane[1].__restore(e.pane1,t))},__findBestPos:function(){this._findBestPos=!0},__moveBar:function(e){var t=this.$container.width(),n=this.$container.height(),r=this.$container.offset();e.x-=r.left,e.y-=r.top;var i=this.__minPos(),s=this.__maxPos();this._horizontal?this.pos((e.x-3)/t):this.pos((e.y-3)/n)},__minPos:function(){var e=this.$container.width(),t=this.$container.height(),n;this._pane[0]&&typeof this._pane[0].minSize=="function"?n=this._pane[0].minSize():n={x:50,y:50};var r;return this._pane[1]&&typeof this._pane[1].maxSize=="function"?r=this._pane[1].maxSize():r={x:e,y:t},r.x=e-Math.min(r.x,e),r.y=t-Math.min(r.y,t),n.x=Math.max(n.x,r.x),n.y=Math.max(n.y,r.y),n},__maxPos:function(){var e=this.$container.width(),t=this.$container.height(),n;this._pane[0]&&typeof this._pane[0].maxSize=="function"?n=this._pane[0].maxSize():n={x:e,y:t};var r;return this._pane[1]&&typeof this._pane[1].minSize=="function"?r=this._pane[1].minSize():r={x:50,y:50},r.x=e-r.x,r.y=t-r.y,n.x=Math.min(r.x,n.x),n.y=Math.min(r.y,n.y),n},__container:function(e){return typeof e=="undefined"?this.$container:(this.$container=e,this.$container?(this.$container.append(this.$pane[0]),this.$container.append(this.$pane[1]),this.$container.append(this.$bar)):(this.$pane[0].remove(),this.$pane[1].remove(),this.$bar.remove()),this.$container)},__removeChild:function(e){if(this._pane[0]===e)this._pane[0]=!1;else{if(this._pane[1]!==e)return;this._pane[1]=!1}e&&(e.__container(null),e._parent=null)},__destroy:function(){this._pane[0]&&this._pane[0].__destroy(),this._pane[1]&&this._pane[1].__destroy(),this.__container(null),this._parent=!1}},function(e,t){function v(e){var t=e.split(/\s+/),n=[];for(var r=0,i;i=t[r];r++)i=i[0].toUpperCase(),n.push(i);return n}function m(t){return t.id&&e('label[for="'+t.id+'"]').val()||t.name}function g(n,r,i){return i||(i=0),r.each(function(){var r=e(this),s=this,o=this.nodeName.toLowerCase(),u,a;o=="label"&&r.find("input, textarea, select").length&&(u=r.text(),r=r.children().first(),s=r.get(0),o=s.nodeName.toLowerCase());switch(o){case"menu":a={name:r.attr("label"),items:{}},i=g(a.items,r.children(),i);break;case"a":case"button":a={name:r.text(),disabled:!!r.attr("disabled"),callback:function(){return function(){r.click()}}()};break;case"menuitem":case"command":switch(r.attr("type")){case t:case"command":case"menuitem":a={name:r.attr("label"),disabled:!!r.attr("disabled"),callback:function(){return function(){r.click()}}()};break;case"checkbox":a={type:"checkbox",disabled:!!r.attr("disabled"),name:r.attr("label"),selected:!!r.attr("checked")};break;case"radio":a={type:"radio",disabled:!!r.attr("disabled"),name:r.attr("label"),radio:r.attr("radiogroup"),value:r.attr("id"),selected:!!r.attr("checked")};break;default:a=t}break;case"hr":a="-------";break;case"input":switch(r.attr("type")){case"text":a={type:"text",name:u||m(s),disabled:!!r.attr("disabled"),value:r.val()};break;case"checkbox":a={type:"checkbox",name:u||m(s),disabled:!!r.attr("disabled"),selected:!!r.attr("checked")};break;case"radio":a={type:"radio",name:u||m(s),disabled:!!r.attr("disabled"),radio:!!r.attr("name"),value:r.val(),selected:!!r.attr("checked")};break;default:a=t}break;case"select":a={type:"select",name:u||m(s),disabled:!!r.attr("disabled"),selected:r.val(),options:{}},r.children().each(function(){a.options[this.value]=e(this).text()});break;case"textarea":a={type:"textarea",name:u||m(s),disabled:!!r.attr("disabled"),value:r.val()};break;case"label":break;default:a={type:"html",html:r.clone(!0)}}a&&(i++,n["key"+i]=a)}),i}e.support.htmlMenuitem="HTMLMenuItemElement"in window,e.support.htmlCommand="HTMLCommandElement"in window,e.support.eventSelectstart="onselectstart"in document.documentElement;if(!e.ui||!e.ui.widget){var n=e.cleanData;e.cleanData=function(t){for(var r=0,i;(i=t[r])!=null;r++)try{e(i).triggerHandler("remove")}catch(s){}n(t)}}var r=null,i=!1,s=e(window),o=0,u={},a={},f={},l={selector:null,appendTo:null,trigger:"right",autoHide:!1,delay:200,reposition:!0,determinePosition:function(t){if(e.ui&&e.ui.position)t.css("display","block").position({my:"center top",at:"center bottom",of:this,offset:"0 5",collision:"fit"}).css("display","none");else{var n=this.offset();n.top+=this.outerHeight(),n.left+=this.outerWidth()/2-t.outerWidth()/2,t.css(n)}},position:function(e,t,n){var r=this,i;if(!t&&!n){e.determinePosition.call(this,e.$menu);return}t==="maintain"&&n==="maintain"?i=e.$menu.position():i={top:n,left:t};var o=s.scrollTop()+s.height(),u=s.scrollLeft()+s.width(),a=e.$menu.height(),f=e.$menu.width();i.top+a>o&&(i.top-=a),i.left+f>u&&(i.left-=f),e.$menu.css(i)},positionSubmenu:function(t){if(e.ui&&e.ui.position)t.css("display","block").position({my:"left top",at:"right top",of:this,collision:"flipfit fit"}).css("display","");else{var n={top:0,left:this.outerWidth()};t.css(n)}},zIndex:1,animation:{duration:50,show:"slideDown",hide:"slideUp"},events:{show:e.noop,hide:e.noop},callback:null,items:{}},c={timer:null,pageX:null,pageY:null},h=function(e){var t=0,n=e;for(;;){t=Math.max(t,parseInt(n.css("z-index"),10)||0),n=n.parent();if(!n||!n.length||"html body".indexOf(n.prop("nodeName").toLowerCase())>-1)break}return t},p={abortevent:function(e){e.preventDefault(),e.stopImmediatePropagation()},contextmenu:function(t){var n=e(this);if(t.data.trigger!="right"&&t.originalEvent)return;if(n.hasClass("context-menu-active"))return;if(!n.hasClass("context-menu-disabled")){t.preventDefault(),t.stopImmediatePropagation(),r=n;if(t.data.build){var i=t.data.build(r,t);if(i===!1)return;t.data=e.extend(!0,{},l,t.data,i||{});if(!t.data.items||e.isEmptyObject(t.data.items))throw window.console&&(console.error||console.log)("No items specified to show in contextMenu"),new Error("No Items specified");t.data.$trigger=r,d.create(t.data)}d.show.call(n,t.data,t.pageX,t.pageY)}},click:function(t){t.preventDefault(),t.stopImmediatePropagation(),e(this).trigger(e.Event("contextmenu",{data:t.data,pageX:t.pageX,pageY:t.pageY}))},mousedown:function(t){var n=e(this);r&&r.length&&!r.is(n)&&r.data("contextMenu").$menu.trigger("contextmenu:hide"),t.button==2&&(r=n.data("contextMenuActive",!0))},mouseup:function(t){var n=e(this);n.data("contextMenuActive")&&r&&r.length&&r.is(n)&&!n.hasClass("context-menu-disabled")&&(t.preventDefault(),t.stopImmediatePropagation(),r=n,n.trigger(e.Event("contextmenu",{data:t.data,pageX:t.pageX,pageY:t.pageY}))),n.removeData("contextMenuActive")},mouseenter:function(t){var n=e(this),i=e(t.relatedTarget),s=e(document);if(i.is(".context-menu-list")||i.closest(".context-menu-list").length)return;if(r&&r.length)return;c.pageX=t.pageX,c.pageY=t.pageY,c.data=t.data,s.on("mousemove.contextMenuShow",p.mousemove),c.timer=setTimeout(function(){c.timer=null,s.off("mousemove.contextMenuShow"),r=n,n.trigger(e.Event("contextmenu",{data:c.data,pageX:c.pageX,pageY:c.pageY}))},t.data.delay)},mousemove:function(e){c.pageX=e.pageX,c.pageY=e.pageY},mouseleave:function(t){var n=e(t.relatedTarget);if(n.is(".context-menu-list")||n.closest(".context-menu-list").length)return;try{clearTimeout(c.timer)}catch(t){}c.timer=null},layerClick:function(t){var n=e(this),r=n.data("contextMenuRoot"),i=!1,o=t.button,u=t.pageX,a=t.pageY,f,l,c;t.preventDefault(),t.stopImmediatePropagation(),setTimeout(function(){var n,i,c,h=r.trigger=="left"&&o===0||r.trigger=="right"&&o===2;document.elementFromPoint&&(r.$layer.hide(),f=document.elementFromPoint(u-s.scrollLeft(),a-s.scrollTop()),r.$layer.show());if(r.reposition&&h)if(document.elementFromPoint){if(r.$trigger.is(f)||r.$trigger.has(f).length){r.position.call(r.$trigger,r,u,a);return}}else{l=r.$trigger.offset(),n=e(window),l.top+=n.scrollTop();if(l.top<=t.pageY){l.left+=n.scrollLeft();if(l.left<=t.pageX){l.bottom=l.top+r.$trigger.outerHeight();if(l.bottom>=t.pageY){l.right=l.left+r.$trigger.outerWidth();if(l.right>=t.pageX){r.position.call(r.$trigger,r,u,a);return}}}}}f&&h&&r.$trigger.one("contextmenu:hidden",function(){e(f).contextMenu({x:u,y:a})}),r.$menu.trigger("contextmenu:hide")},50)},keyStop:function(e,t){t.isInput||e.preventDefault(),e.stopPropagation()},key:function(e){var t=r.data("contextMenu")||{};switch(e.keyCode){case 9:case 38:p.keyStop(e,t);if(t.isInput){if(e.keyCode==9&&e.shiftKey){e.preventDefault(),t.$selected&&t.$selected.find("input, textarea, select").blur(),t.$menu.trigger("prevcommand");return}if(e.keyCode==38&&t.$selected.find("input, textarea, select").prop("type")=="checkbox"){e.preventDefault();return}}else if(e.keyCode!=9||e.shiftKey){t.$menu.trigger("prevcommand");return};case 40:p.keyStop(e,t);if(!t.isInput){t.$menu.trigger("nextcommand");return}if(e.keyCode==9){e.preventDefault(),t.$selected&&t.$selected.find("input, textarea, select").blur(),t.$menu.trigger("nextcommand");return}if(e.keyCode==40&&t.$selected.find("input, textarea, select").prop("type")=="checkbox"){e.preventDefault();return}break;case 37:p.keyStop(e,t);if(t.isInput||!t.$selected||!t.$selected.length)break;if(!t.$selected.parent().hasClass("context-menu-root")){var n=t.$selected.parent().parent();t.$selected.trigger("contextmenu:blur"),t.$selected=n;return}break;case 39:p.keyStop(e,t);if(t.isInput||!t.$selected||!t.$selected.length)break;var i=t.$selected.data("contextMenu")||{};if(i.$menu&&t.$selected.hasClass("context-menu-submenu")){t.$selected=null,i.$selected=null,i.$menu.trigger("nextcommand");return}break;case 35:case 36:if(t.$selected&&t.$selected.find("input, textarea, select").length)return;(t.$selected&&t.$selected.parent()||t.$menu).children(":not(.disabled, .not-selectable)")[e.keyCode==36?"first":"last"]().trigger("contextmenu:focus"),e.preventDefault();return;case 13:p.keyStop(e,t);if(t.isInput){if(t.$selected&&!t.$selected.is("textarea, select")){e.preventDefault();return}break}t.$selected&&t.$selected.trigger("mouseup");return;case 32:case 33:case 34:p.keyStop(e,t);return;case 27:p.keyStop(e,t),t.$menu.trigger("contextmenu:hide");return;default:var s=String.fromCharCode(e.keyCode).toUpperCase();if(t.accesskeys[s]){t.accesskeys[s].$node.trigger(t.accesskeys[s].$menu?"contextmenu:focus":"mouseup");return}}e.stopPropagation(),t.$selected&&t.$selected.trigger(e)},prevItem:function(t){t.stopPropagation();var n=e(this).data("contextMenu")||{};if(n.$selected){var r=n.$selected;n=n.$selected.parent().data("contextMenu")||{},n.$selected=r}var i=n.$menu.children(),s=!n.$selected||!n.$selected.prev().length?i.last():n.$selected.prev(),o=s;while(s.hasClass("disabled")||s.hasClass("not-selectable")){s.prev().length?s=s.prev():s=i.last();if(s.is(o))return}n.$selected&&p.itemMouseleave.call(n.$selected.get(0),t),p.itemMouseenter.call(s.get(0),t);var u=s.find("input, textarea, select");u.length&&u.focus()},nextItem:function(t){t.stopPropagation();var n=e(this).data("contextMenu")||{};if(n.$selected){var r=n.$selected;n=n.$selected.parent().data("contextMenu")||{},n.$selected=r}var i=n.$menu.children(),s=!n.$selected||!n.$selected.next().length?i.first():n.$selected.next(),o=s;while(s.hasClass("disabled")||s.hasClass("not-selectable")){s.next().length?s=s.next():s=i.first();if(s.is(o))return}n.$selected&&p.itemMouseleave.call(n.$selected.get(0),t),p.itemMouseenter.call(s.get(0),t);var u=s.find("input, textarea, select");u.length&&u.focus()},focusInput:function(t){var n=e(this).closest(".context-menu-item"),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;s.$selected=i.$selected=n,s.isInput=i.isInput=!0},blurInput:function(t){var n=e(this).closest(".context-menu-item"),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;s.isInput=i.isInput=!1},menuMouseenter:function(t){var n=e(this).data().contextMenuRoot;n.hovering=!0},menuMouseleave:function(t){var n=e(this).data().contextMenuRoot;n.$layer&&n.$layer.is(t.relatedTarget)&&(n.hovering=!1)},itemMouseenter:function(t){var n=e(this),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;s.hovering=!0,t&&s.$layer&&s.$layer.is(t.relatedTarget)&&(t.preventDefault(),t.stopImmediatePropagation()),(i.$menu?i:s).$menu.children(".hover").trigger("contextmenu:blur");if(n.hasClass("disabled")||n.hasClass("not-selectable")){i.$selected=null;return}n.trigger("contextmenu:focus")},itemMouseleave:function(t){var n=e(this),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;if(s!==i&&s.$layer&&s.$layer.is(t.relatedTarget)){s.$selected&&s.$selected.trigger("contextmenu:blur"),t.preventDefault(),t.stopImmediatePropagation(),s.$selected=i.$selected=i.$node;return}n.trigger("contextmenu:blur")},itemClick:function(t){var n=e(this),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot,o=r.contextMenuKey,u;if(!i.items[o]||n.is(".disabled, .context-menu-submenu, .context-menu-separator, .not-selectable"))return;t.preventDefault(),t.stopImmediatePropagation();if(e.isFunction(s.callbacks[o])&&Object.prototype.hasOwnProperty.call(s.callbacks,o))u=s.callbacks[o];else{if(!e.isFunction(s.callback))return;u=s.callback}u.call(s.$trigger,o,s)!==!1?s.$menu.trigger("contextmenu:hide"):s.$menu.parent().length&&d.update.call(s.$trigger,s)},inputClick:function(e){e.stopImmediatePropagation()},hideMenu:function(t,n){var r=e(this).data("contextMenuRoot");d.hide.call(r.$trigger,r,n&&n.force)},focusItem:function(t){t.stopPropagation();var n=e(this),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;n.addClass("hover").siblings(".hover").trigger("contextmenu:blur"),i.$selected=s.$selected=n,i.$node&&s.positionSubmenu.call(i.$node,i.$menu)},blurItem:function(t){t.stopPropagation();var n=e(this),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;n.removeClass("hover"),i.$selected=null}},d={show:function(t,n,i){var s=e(this),o,u={};e("#context-menu-layer").trigger("mousedown"),t.$trigger=s;if(t.events.show.call(s,t)===!1){r=null;return}d.update.call(s,t),t.position.call(s,t,n,i),t.zIndex&&(u.zIndex=h(s)+t.zIndex),d.layer.call(t.$menu,t,u.zIndex),t.$menu.find("ul").css("zIndex",u.zIndex+1),t.$menu.css(u)[t.animation.show](t.animation.duration,function(){s.trigger("contextmenu:visible")}),s.data("contextMenu",t).addClass("context-menu-active"),e(document).off("keydown.contextMenu").on("keydown.contextMenu",p.key),t.autoHide&&e(document).on("mousemove.contextMenuAutoHide",function(e){var n=s.offset();n.right=n.left+s.outerWidth(),n.bottom=n.top+s.outerHeight(),t.$layer&&!t.hovering&&(!(e.pageX>=n.left&&e.pageX<=n.right)||!(e.pageY>=n.top&&e.pageY<=n.bottom))&&t.$menu.trigger("contextmenu:hide")})},hide:function(n,i){var s=e(this);n||(n=s.data("contextMenu")||{});if(!i&&n.events&&n.events.hide.call(s,n)===!1)return;s.removeData("contextMenu").removeClass("context-menu-active");if(n.$layer){setTimeout(function(e){return function(){e.remove()}}(n.$layer),10);try{delete n.$layer}catch(o){n.$layer=null}}r=null,n.$menu.find(".hover").trigger("contextmenu:blur"),n.$selected=null,e(document).off(".contextMenuAutoHide").off("keydown.contextMenu"),n.$menu&&n.$menu[n.animation.hide](n.animation.duration,function(){n.build&&(n.$menu.remove(),e.each(n,function(e,r){switch(e){case"ns":case"selector":case"build":case"trigger":return!0;default:n[e]=t;try{delete n[e]}catch(i){}return!0}})),setTimeout(function(){s.trigger("contextmenu:hidden")},10)})},create:function(n,r){r===t&&(r=n),n.$menu=e('<ul class="context-menu-list"></ul>').addClass(n.className||"").data({contextMenu:n,contextMenuRoot:r}),e.each(["callbacks","commands","inputs"],function(e,t){n[t]={},r[t]||(r[t]={})}),r.accesskeys||(r.accesskeys={}),e.each(n.items,function(t,i){var s=e('<li class="context-menu-item"></li>').addClass(i.className||""),o=null,u=null;s.on("click",e.noop),i.$node=s.data({contextMenu:n,contextMenuRoot:r,contextMenuKey:t});if(i.accesskey){var a=v(i.accesskey);for(var l=0,c;c=a[l];l++)if(!r.accesskeys[c]){r.accesskeys[c]=i,i._name=i.name.replace(new RegExp("("+c+")","i"),'<span class="context-menu-accesskey">$1</span>');break}}if(typeof i=="string")s.addClass("context-menu-separator not-selectable");else if(i.type&&f[i.type])f[i.type].call(s,i,n,r),e.each([n,r],function(n,r){r.commands[t]=i,e.isFunction(i.callback)&&(r.callbacks[t]=i.callback)});else{i.type=="html"?s.addClass("context-menu-html not-selectable"):i.type?(o=e("<label></label>").appendTo(s),e("<span></span>").html(i._name||i.name).appendTo(o),s.addClass("context-menu-input"),n.hasTypes=!0,e.each([n,r],function(e,n){n.commands[t]=i,n.inputs[t]=i})):i.items&&(i.type="sub");switch(i.type){case"text":u=e('<input type="text" value="1" name="" value="">').attr("name","context-menu-input-"+t).val(i.value||"").appendTo(o);break;case"textarea":u=e('<textarea name=""></textarea>').attr("name","context-menu-input-"+t).val(i.value||"").appendTo(o),i.height&&u.height(i.height);break;case"checkbox":u=e('<input type="checkbox" value="1" name="" value="">').attr("name","context-menu-input-"+t).val(i.value||"").prop("checked",!!i.selected).prependTo(o);break;case"radio":u=e('<input type="radio" value="1" name="" value="">').attr("name","context-menu-input-"+i.radio).val(i.value||"").prop("checked",!!i.selected).prependTo(o);break;case"select":u=e('<select name="">').attr("name","context-menu-input-"+t).appendTo(o),i.options&&(e.each(i.options,function(t,n){e("<option></option>").val(t).text(n).appendTo(u)}),u.val(i.selected));break;case"sub":e("<span></span>").html(i._name||i.name).appendTo(s),i.appendTo=i.$node,d.create(i,r),s.data("contextMenu",i).addClass("context-menu-submenu"),i.callback=null;break;case"html":e(i.html).appendTo(s);break;default:e.each([n,r],function(n,r){r.commands[t]=i,e.isFunction(i.callback)&&(r.callbacks[t]=i.callback)}),e("<span></span>").html(i._name||i.name||"").appendTo(s)}i.type&&i.type!="sub"&&i.type!="html"&&(u.on("focus",p.focusInput).on("blur",p.blurInput),i.events&&u.on(i.events,n)),i.icon&&s.addClass("icon icon-"+i.icon)}i.$input=u,i.$label=o,s.appendTo(n.$menu),!n.hasTypes&&e.support.eventSelectstart&&s.on("selectstart.disableTextSelect",p.abortevent)}),n.$node||n.$menu.css("display","none").addClass("context-menu-root"),n.$menu.appendTo(n.appendTo||document.body)},resize:function(t,n){t.css({position:"absolute",display:"block"}),t.data("width",Math.ceil(t.width())+1),t.css({position:"static",minWidth:"0px",maxWidth:"100000px"}),t.find("> li > ul").each(function(){d.resize(e(this),!0)}),n||t.find("ul").andSelf().css({position:"",display:"",minWidth:"",maxWidth:""}).width(function(){return e(this).data("width")})},update:function(n,r){var i=this;r===t&&(r=n,d.resize(n.$menu)),n.$menu.children().each(function(){var t=e(this),s=t.data("contextMenuKey"),o=n.items[s],u=e.isFunction(o.disabled)&&o.disabled.call(i,s,r)||o.disabled===!0;t[u?"addClass":"removeClass"]("disabled");if(o.type){t.find("input, select, textarea").prop("disabled",u);switch(o.type){case"text":case"textarea":o.$input.val(o.value||"");break;case"checkbox":case"radio":o.$input.val(o.value||"").prop("checked",!!o.selected);break;case"select":o.$input.val(o.selected||"")}}o.$menu&&d.update.call(i,o,r)})},layer:function(t,n){var r=t.$layer=e('<div id="context-menu-layer" style="position:fixed; z-index:'+n+'; top:0; left:0; opacity: 0; filter: alpha(opacity=0); background-color: #000;"></div>').css({height:s.height(),width:s.width(),display:"block"}).data("contextMenuRoot",t).insertBefore(this).on("contextmenu",p.abortevent).on("mousedown",p.layerClick);return e.support.fixedPosition||r.css({position:"absolute",height:e(document).height()}),r}};e.fn.contextMenu=function(n){if(n===t)this.first().trigger("contextmenu");else if(n.x&&n.y)this.first().trigger(e.Event("contextmenu",{pageX:n.x,pageY:n.y}));else if(n==="hide"){var r=this.data("contextMenu").$menu;r&&r.trigger("contextmenu:hide")}else n==="destroy"?e.contextMenu("destroy",{context:this}):e.isPlainObject(n)?(n.context=this,e.contextMenu("create",n)):n?this.removeClass("context-menu-disabled"):n||this.addClass("context-menu-disabled");return this},e.contextMenu=function(n,r){typeof n!="string"&&(r=n,n="create"),typeof r=="string"?r={selector:r}:r===t&&(r={});var s=e.extend(!0,{},l,r||{}),f=e(document),c=f,h=!1;!s.context||!s.context.length?s.context=document:(c=e(s.context).first(),s.context=c.get(0),h=s.context!==document);switch(n){case"create":if(!s.selector)throw new Error("No selector specified");if(s.selector.match(/.context-menu-(list|item|input)($|\s)/))throw new Error('Cannot bind to selector "'+s.selector+'" as it contains a reserved className');if(!s.build&&(!s.items||e.isEmptyObject(s.items)))throw new Error("No Items specified");o++,s.ns=".contextMenu"+o,h||(u[s.selector]=s.ns),a[s.ns]=s,s.trigger||(s.trigger="right"),i||(f.on({"contextmenu:hide.contextMenu":p.hideMenu,"prevcommand.contextMenu":p.prevItem,"nextcommand.contextMenu":p.nextItem,"contextmenu.contextMenu":p.abortevent,"mouseenter.contextMenu":p.menuMouseenter,"mouseleave.contextMenu":p.menuMouseleave},".context-menu-list").on("mouseup.contextMenu",".context-menu-input",p.inputClick).on({"mouseup.contextMenu":p.itemClick,"contextmenu:focus.contextMenu":p.focusItem,"contextmenu:blur.contextMenu":p.blurItem,"contextmenu.contextMenu":p.abortevent,"mouseenter.contextMenu":p.itemMouseenter,"mouseleave.contextMenu":p.itemMouseleave},".context-menu-item"),i=!0),c.on("contextmenu"+s.ns,s.selector,s,p.contextmenu),h&&c.on("remove"+s.ns,function(){e(this).contextMenu("destroy")});switch(s.trigger){case"hover":c.on("mouseenter"+s.ns,s.selector,s,p.mouseenter).on("mouseleave"+s.ns,s.selector,s,p.mouseleave);break;case"left":c.on("click"+s.ns,s.selector,s,p.click)}s.build||d.create(s);break;case"destroy":var v;if(h){var m=s.context;e.each(a,function(t,n){if(n.context!==m)return!0;v=e(".context-menu-list").filter(":visible"),v.length&&v.data().contextMenuRoot.$trigger.is(e(n.context).find(n.selector))&&v.trigger("contextmenu:hide",{force:!0});try{a[n.ns].$menu&&a[n.ns].$menu.remove(),delete a[n.ns]}catch(r){a[n.ns]=null}return e(n.context).off(n.ns),!0})}else if(!s.selector)f.off(".contextMenu .contextMenuAutoHide"),e.each(a,function(t,n){e(n.context).off(n.ns)}),u={},a={},o=0,i=!1,e("#context-menu-layer, .context-menu-list").remove();else if(u[s.selector]){v=e(".context-menu-list").filter(":visible"),v.length&&v.data().contextMenuRoot.$trigger.is(s.selector)&&v.trigger("contextmenu:hide",{force:!0});try{a[u[s.selector]].$menu&&a[u[s.selector]].$menu.remove(),delete a[u[s.selector]]}catch(g){a[u[s.selector]]=null}f.off(u[s.selector])}break;case"html5":(!e.support.htmlCommand&&!e.support.htmlMenuitem||typeof r=="boolean"&&r)&&e('menu[type="context"]').each(function(){this.id&&e.contextMenu({selector:"[contextmenu="+this.id+"]",items:e.contextMenu.fromMenu(this)})}).css("display","none");break;default:throw new Error('Unknown operation "'+n+'"')}return this},e.contextMenu.setInputValues=function(n,r){r===t&&(r={}),e.each(n.inputs,function(e,t){switch(t.type){case"text":case"textarea":t.value=r[e]||"";break;case"checkbox":t.selected=r[e]?!0:!1;break;case"radio":t.selected=(r[t.radio]||"")==t.value?!0:!1;break;case"select":t.selected=r[e]||""}})},e.contextMenu.getInputValues=function(n,r){return r===t&&(r={}),e.each(n.inputs,function(e,t){switch(t.type){case"text":case"textarea":case"select":r[e]=t.$input.val();break;case"checkbox":r[e]=t.$input.prop("checked");break;case"radio":t.$input.prop("checked")&&(r[t.radio]=t.value)}}),r},e.contextMenu.fromMenu=function(t){var n=e(t),r={};return g(r,n.children()),r},e.contextMenu.defaults=l,e.contextMenu.types=f,e.contextMenu.handle=p,e.contextMenu.op=d,e.contextMenu.menus=a}(jQuery),function(e,t){function h(e,t,n){return[parseInt(e[0],10)*(l.test(e[0])?t/100:1),parseInt(e[1],10)*(l.test(e[1])?n/100:1)]}function p(t,n){return parseInt(e.css(t,n),10)||0}function d(t){var n=t[0];return n.nodeType===9?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(n)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:n.preventDefault?{width:0,height:0,offset:{top:n.pageY,left:n.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.ui=e.ui||{};var n,r=Math.max,i=Math.abs,s=Math.round,o=/left|center|right/,u=/top|center|bottom/,a=/[\+\-]\d+%?/,f=/^\w+/,l=/%$/,c=e.fn.position;e.position={scrollbarWidth:function(){if(n!==t)return n;var r,i,s=e("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=s.children()[0];return e("body").append(s),r=o.offsetWidth,s.css("overflow","scroll"),i=o.offsetWidth,r===i&&(i=s[0].clientWidth),s.remove(),n=r-i},getScrollInfo:function(t){var n=t.isWindow?"":t.element.css("overflow-x"),r=t.isWindow?"":t.element.css("overflow-y"),i=n==="scroll"||n==="auto"&&t.width<t.element[0].scrollWidth,s=r==="scroll"||r==="auto"&&t.height<t.element[0].scrollHeight;return{width:i?e.position.scrollbarWidth():0,height:s?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var n=e(t||window),r=e.isWindow(n[0]);return{element:n,isWindow:r,offset:n.offset()||{left:0,top:0},scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop(),width:r?n.width():n.outerWidth(),height:r?n.height():n.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return c.apply(this,arguments);t=e.extend({},t);var n,l,v,m,g,y,b=e(t.of),w=e.position.getWithinInfo(t.within),E=e.position.getScrollInfo(w),S=(t.collision||"flip").split(" "),x={};return y=d(b),b[0].preventDefault&&(t.at="left top"),l=y.width,v=y.height,m=y.offset,g=e.extend({},m),e.each(["my","at"],function(){var e=(t[this]||"").split(" "),n,r;e.length===1&&(e=o.test(e[0])?e.concat(["center"]):u.test(e[0])?["center"].concat(e):["center","center"]),e[0]=o.test(e[0])?e[0]:"center",e[1]=u.test(e[1])?e[1]:"center",n=a.exec(e[0]),r=a.exec(e[1]),x[this]=[n?n[0]:0,r?r[0]:0],t[this]=[f.exec(e[0])[0],f.exec(e[1])[0]]}),S.length===1&&(S[1]=S[0]),t.at[0]==="right"?g.left+=l:t.at[0]==="center"&&(g.left+=l/2),t.at[1]==="bottom"?g.top+=v:t.at[1]==="center"&&(g.top+=v/2),n=h(x.at,l,v),g.left+=n[0],g.top+=n[1],this.each(function(){var o,u,a=e(this),f=a.outerWidth(),c=a.outerHeight(),d=p(this,"marginLeft"),y=p(this,"marginTop"),T=f+d+p(this,"marginRight")+E.width,N=c+y+p(this,"marginBottom")+E.height,C=e.extend({},g),k=h(x.my,a.outerWidth(),a.outerHeight());t.my[0]==="right"?C.left-=f:t.my[0]==="center"&&(C.left-=f/2),t.my[1]==="bottom"?C.top-=c:t.my[1]==="center"&&(C.top-=c/2),C.left+=k[0],C.top+=k[1],e.support.offsetFractions||(C.left=s(C.left),C.top=s(C.top)),o={marginLeft:d,marginTop:y},e.each(["left","top"],function(r,i){e.ui.position[S[r]]&&e.ui.position[S[r]][i](C,{targetWidth:l,targetHeight:v,elemWidth:f,elemHeight:c,collisionPosition:o,collisionWidth:T,collisionHeight:N,offset:[n[0]+k[0],n[1]+k[1]],my:t.my,at:t.at,within:w,elem:a})}),t.using&&(u=function(e){var n=m.left-C.left,s=n+l-f,o=m.top-C.top,u=o+v-c,h={target:{element:b,left:m.left,top:m.top,width:l,height:v},element:{element:a,left:C.left,top:C.top,width:f,height:c},horizontal:s<0?"left":n>0?"right":"center",vertical:u<0?"top":o>0?"bottom":"middle"};l<f&&i(n+s)<l&&(h.horizontal="center"),v<c&&i(o+u)<v&&(h.vertical="middle"),r(i(n),i(s))>r(i(o),i(u))?h.important="horizontal":h.important="vertical",t.using.call(this,e,h)}),a.offset(e.extend(C,{using:u}))})},e.ui.position={fit:{left:function(e,t){var n=t.within,i=n.isWindow?n.scrollLeft:n.offset.left,s=n.width,o=e.left-t.collisionPosition.marginLeft,u=i-o,a=o+t.collisionWidth-s-i,f;t.collisionWidth>s?u>0&&a<=0?(f=e.left+u+t.collisionWidth-s-i,e.left+=u-f):a>0&&u<=0?e.left=i:u>a?e.left=i+s-t.collisionWidth:e.left=i:u>0?e.left+=u:a>0?e.left-=a:e.left=r(e.left-o,e.left)},top:function(e,t){var n=t.within,i=n.isWindow?n.scrollTop:n.offset.top,s=t.within.height,o=e.top-t.collisionPosition.marginTop,u=i-o,a=o+t.collisionHeight-s-i,f;t.collisionHeight>s?u>0&&a<=0?(f=e.top+u+t.collisionHeight-s-i,e.top+=u-f):a>0&&u<=0?e.top=i:u>a?e.top=i+s-t.collisionHeight:e.top=i:u>0?e.top+=u:a>0?e.top-=a:e.top=r(e.top-o,e.top)}},flip:{left:function(e,t){var n=t.within,r=n.offset.left+n.scrollLeft,s=n.width,o=n.isWindow?n.scrollLeft:n.offset.left,u=e.left-t.collisionPosition.marginLeft,a=u-o,f=u+t.collisionWidth-s-o,l=t.my[0]==="left"?-t.elemWidth:t.my[0]==="right"?t.elemWidth:0,c=t.at[0]==="left"?t.targetWidth:t.at[0]==="right"?-t.targetWidth:0,h=-2*t.offset[0],p,d;if(a<0){p=e.left+l+c+h+t.collisionWidth-s-r;if(p<0||p<i(a))e.left+=l+c+h}else if(f>0){d=e.left-t.collisionPosition.marginLeft+l+c+h-o;if(d>0||i(d)<f)e.left+=l+c+h}},top:function(e,t){var n=t.within,r=n.offset.top+n.scrollTop,s=n.height,o=n.isWindow?n.scrollTop:n.offset.top,u=e.top-t.collisionPosition.marginTop,a=u-o,f=u+t.collisionHeight-s-o,l=t.my[1]==="top",c=l?-t.elemHeight:t.my[1]==="bottom"?t.elemHeight:0,h=t.at[1]==="top"?t.targetHeight:t.at[1]==="bottom"?-t.targetHeight:0,p=-2*t.offset[1],d,v;a<0?(v=e.top+c+h+p+t.collisionHeight-s-r,e.top+c+h+p>a&&(v<0||v<i(a))&&(e.top+=c+h+p)):f>0&&(d=e.top-t.collisionPosition.marginTop+c+h+p-o,e.top+c+h+p>f&&(d>0||i(d)<f)&&(e.top+=c+h+p))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,n,r,i,s,o=document.getElementsByTagName("body")[0],u=document.createElement("div");t=document.createElement(o?"div":"body"),r={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},o&&e.extend(r,{position:"absolute",left:"-1000px",top:"-1000px"});for(s in r)t.style[s]=r[s];t.appendChild(u),n=o||document.documentElement,n.insertBefore(t,n.firstChild),u.style.cssText="position: absolute; left: 10.7432222px;",i=e(u).offset().left,e.support.offsetFractions=i>10&&i<11,t.innerHTML="",n.removeChild(t)}()}(jQuery)